<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Roblox Logo Creator – Drag & Drop FIXED</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:#444444; --card:#444444; --panel:#555555; --border:#666666;
      --text:#e0e0e0; --muted:#aaaaaa; --accent:#3a8de0;
      --input-bg:#666666; --input-border:#777777;
      --drop-bg:#666666; --drop-border:#3a8de0;
    }
    *{box-sizing:border-box;margin:0;padding:0;}
    html,body{height:100%;background:var(--bg);font-family:'Montserrat',sans-serif;color:var(--text);}
    body{display:flex;flex-direction:column;}
    .wrap{flex:1;display:flex;flex-direction:column;align-items:center;padding:12px;gap:16px;}
    .card{width:100%;max-width:1100px;display:flex;flex-direction:column;gap:16px;background:var(--card);border-radius:16px;padding:16px;box-shadow:0 8px 32px rgba(0,0,0,.3);}
    h1{margin:0 0 8px;text-align:center;font-size:20px;font-weight:700;color:var(--accent);}
    #preview{position:relative;width:100%;min-height:140px;background:rgba(0,0,0,.15);border-radius:12px;overflow:hidden;display:flex;align-items:center;justify-content:center;}
    #svgLayer{position:absolute;inset:0;width:100%;height:100%;z-index:2;pointer-events:none;}
    #textbox{
      position:relative;z-index:1;
      padding:16px;font-size:48px;
      color:transparent !important;text-shadow:none !important;
      caret-color:var(--text);
      text-align:center;white-space:pre-wrap;word-break:break-word;
      width:100%;outline:none;
      user-select:text;-webkit-user-select:text;cursor:text;
    }
    #textbox:empty:before{content:attr(data-placeholder);color:#888;font-size:48px;position:absolute;pointer-events:none;}
    .controls{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;margin-top:12px;}
    .control{display:flex;flex-direction:column;gap:6px;}
    .label{text-align:center;color:var(--muted);font-size:12px;font-weight:600;}
    input[type=range]{width:100%;height:6px;border-radius:3px;background:#777;appearance:none;}
    input[type=range]::-webkit-slider-thumb{appearance:none;width:18px;height:18px;border-radius:50%;background:var(--accent);}
    input[type=number]{width:100%;padding:8px;border-radius:6px;border:1px solid var(--input-border);background:var(--input-bg);color:var(--text);font-size:14px;text-align:center;}
    button{padding:10px;border-radius:8px;border:none;cursor:pointer;transition:.2s;font-size:13px;font-weight:600;width:100%;}
    button.btn{background:var(--accent);color:#fff;}
    button.small{background:var(--input-bg);color:var(--text);font-size:12px;}
    button:hover{background:var(--accent);color:#fff;}
    .side{background:var(--panel);padding:16px;border-radius:12px;border:1px solid var(--border);width:100%;max-width:400px;}
    .fontsList{
      flex:1;overflow:auto;padding:8px;
      background:var(--input-bg);border-radius:8px;
      margin-top:8px;border:1px solid var(--border);
      max-height:300px;position:relative;
    }
    .dropZone{
      position:absolute;inset:0;
      display:flex;align-items:center;justify-content:center;
      background:rgba(0,0,0,.5);color:var(--accent);
      font-size:16px;font-weight:600;
      border:3px dashed var(--drop-border);
      border-radius:8px;opacity:0;pointer-events:none;
      transition:opacity .2s;z-index:10;
    }
    .dropZone.active{opacity:1;pointer-events:all;}
    .dropZone span{display:block;text-align:center;}
    .sectionTitle{font-family:'Roboto',sans-serif;font-size:12px;color:var(--accent);margin:8px 0 4px;font-weight:500;text-transform:uppercase;letter-spacing:1px;}
    .fontItem{display:flex;align-items:center;justify-content:space-between;padding:10px;border-radius:8px;margin-bottom:6px;background:var(--input-bg);cursor:pointer;border:1px solid var(--border);font-size:14px;}
    .fontItem:hover{background:#777;}
    .fontPreview{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1;padding-right:8px;}
    .fontActions button{padding:4px 8px;font-size:11px;}
    .color-picker{display:flex;gap:6px;align-items:center;width:100%;}
    .swatch{width:36px;height:36px;border-radius:6px;border:2px solid var(--border);cursor:pointer;}
    .hex{width:auto;min-width:60px;max-width:80px;padding:4px 6px;border-radius:4px;border:urun:1px solid var(--input-border);background:var(--input-bg);color:var(--text);font-family:monospace;font-size:12px;text-align:center;}
    .copy-btn{padding:4px 8px;font-size:11px;min-width:44px;}
    @media (min-width:768px){.card{flex-direction:row;}.controls{grid-template-columns:repeat(3,1fr);}.side{width:340px;}.fontsList{max-height:none;}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div style="width:100%;">
        <h1>Roblox Logo Creator</h1>
        <div id="preview">
          <svg id="svgLayer" xmlns="http://www.w3.org/2000/svg"></svg>
          <div id="textbox" contenteditable data-placeholder="Type your logo text here">Roblox</div>
        </div>

        <div class="controls">
          <div class="control"><span class="label">Font</span><button class="btn" id="uploadBtn">Upload</button><input id="fontFile" type="file" accept=".ttf,.otf,.woff,.woff2" multiple style="display:none"></div>

          <div class="control"><span class="label">Text Color</span>
            <div class="color-picker" data-type="fill">
              <div class="swatch" data-hex="#ffffff" style="background:#ffffff"></div>
              <input type="text" class="hex" value="#ffffff">
              <button class="copy-btn small">Copy</button>
            </div>
          </div>

          <div class="control"><span class="label">Stroke Color</span>
            <div class="color-picker" data-type="stroke">
              <div class="swatch" data-hex="#000000" style="background:#000000"></div>
              <input type="text" class="hex" value="#000000">
              <button class="copy-btn small">Copy</button>
            </div>
          </div>

          <div class="control"><span class="label">Stroke Size</span><input id="strokeRange" type="range" min="0" max="80" step="0.5" value="2"><input id="strokeNumber" type="number" min="0" max="2000" step="0.1" value="2"></div>
          <div class="control"><span class="label">Text Size</span><input id="textRange" type="range" min="8" max="450" step="1" value="56"><input id="textNumber" type="number" min="6" max="4000" step="1" value="56"></div>

          <div class="control"><span class="label">Stroke</span><button class="small" id="toggleStroke">ON</button></div>

          <div class="control"><span class="label">Sync</span>
            <select id="syncSelect" style="width:100%;padding:8px;border-radius:6px;border:1px solid var(--input-border);background:var(--input-bg);color:var(--text);font-size:13px;">
              <option value="">—</option>
              <option value="stroke->fill">Stroke to Text</option>
              <option value="fill->stroke">Text to Stroke</option>
            </select>
            <button class="small" id="applySync">Apply</button>
          </div>

          <div class="control"><span class="label">Export</span><button class="btn" id="exportBtn">PNG</button></div>
        </div>
      </div>

      <div class="side">
        <div style="display:flex;gap:8px;align-items:center;">
          <h3 style="margin:0;color:var(--accent);font-weight:600;font-size:16px;">Font Manager</h3>
          <button class="small" id="clearAll">Clear All</button>
        </div>
        <div style="margin-top:8px;"><button class="btn" id="panelUpload" style="width:100%;">Upload Font</button><input id="panelFile" type="file" accept=".ttf,.otf,.woff,.woff2" multiple style="display:none"></div>
        <div class="fontsList" id="fontsList">
          <div class="dropZone" id="dropZone"><span>Drop font files here</span></div>
          <div class="sectionTitle">Saved Fonts</div>
          <div id="savedList"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const $ = s => document.querySelector(s);
    const $$ = s => document.querySelectorAll(s);

    let strokeOn = true;
    let currentFont = null;
    const DB_NAME = 'RobloxLogoCreator';
    const STORE_NAME = 'fonts';
    let db;

    // === IndexedDB ===
    const openDB = () => new Promise((res, rej) => {
      const req = indexedDB.open(DB_NAME, 1);
      req.onupgradeneeded = e => { db = e.target.result; db.createObjectStore(STORE_NAME, {keyPath: 'id'}); };
      req.onsuccess = e => { db = e.target.result; res(db); };
      req.onerror = () => rej(req.error);
    });

    const addFont = font => new Promise((res, rej) => {
      const tx = db.transaction(STORE_NAME, 'readwrite');
      tx.oncomplete = res; tx.onerror = () => rej(tx.error);
      tx.objectStore(STORE_NAME).add(font);
    });

    const getAllFonts = () => new Promise((res, rej) => {
      const tx = db.transaction(STORE_NAME, 'readonly');
      const req = tx.objectStore(STORE_NAME).getAll();
      req.onsuccess = () => res(req.result);
      req.onerror = () => rej(req.error);
    });

    const deleteFont = id => new Promise((res, rej) => {
      const tx = db.transaction(STORE_NAME, 'readwrite');
      tx.oncomplete = res; tx.onerror = () => rej(tx.error);
      tx.objectStore(STORE_NAME).delete(id);
    });

    const clearAllFonts = () => new Promise((res, rej) => {
      const tx = db.transaction(STORE_NAME, 'readwrite');
      tx.oncomplete = res; tx.onerror = () => rej(tx.error);
      tx.objectStore(STORE_NAME).clear();
    });

    // === File to Data URL ===
    const toDataURL = file => new Promise(res => {
      const reader = new FileReader();
      reader.onload = () => res(reader.result);
      reader.readAsDataURL(file);
    });

    // === Render SVG Only ===
    async function render() {
      const text = $('#textbox').innerText.trim();
      if (!text) { $('#svgLayer').innerHTML = ''; return; }

      const size = Math.max(6, parseInt($('#textNumber').value) || 56);
      const strokeW = strokeOn ? (parseFloat($('#strokeNumber').value) || 0) : 0;
      const fill = $('.color-picker[data-type="fill"] .swatch').dataset.hex;
      const stroke = $('.color-picker[data-type="stroke"] .swatch').dataset.hex;
      const family = currentFont ? `'${currentFont.family}'` : 'Montserrat';

      const meas = document.createElement('div');
      meas.style.cssText = `position:absolute;visibility:hidden;white-space:nowrap;font:${size}px ${family};`;
      meas.textContent = text.replace(/\n/g, ' ');
      document.body.appendChild(meas);
      const maxW = meas.offsetWidth;
      document.body.removeChild(meas);

      const lines = text.split('\n');
      const lineH = size * 1.15;
      const totalH = lines.length * lineH;
      const pad = Math.max(20, strokeW * 2 + 10);
      const w = maxW + pad * 2;
      const h = totalH + pad * 2;

      let svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${w} ${h}" width="100%" height="100%">`;

      if (currentFont) {
        const ext = currentFont.fileName.split('.').pop().toLowerCase();
        const fmt = {ttf:'truetype',otf:'opentype',woff:'woff',woff2:'woff2'}[ext] || 'truetype';
        svg += `<defs><style>@font-face{font-family:'${currentFont.family}';src:url('${currentFont.dataURL}') format('${fmt}');}</style></defs>`;
      }

      lines.forEach((line, i) => {
        const x = pad + maxW / 2;
        const y = pad + i * lineH + size * 0.8;
        if (strokeW > 0) {
          svg += `<text x="${x}" y="${y}" font-family="${family}" font-size="${size}" fill="${stroke}" text-anchor="middle" stroke="${stroke}" stroke-width="${strokeW*2}" stroke-linejoin="round">${line}</text>`;
          svg += `<text x="${x}" y="${y}" font-family="${family}" font-size="${size}" fill="${fill}" text-anchor="middle">${line}</text>`;
        } else {
          svg += `<text x="${x}" y="${y}" font-family="${family}" font-size="${size}" fill="${fill}" text-anchor="middle">${line}</text>`;
        }
      });
      svg += `</svg>`;
      $('#svgLayer').innerHTML = svg;

      $('#textbox').style.fontSize = size + 'px';
      $('#textbox').style.fontFamily = family + ', sans-serif';
    }

    // === Color Picker ===
    $$('.color-picker').forEach(p => {
      const sw = p.querySelector('.swatch');
      const inp = p.querySelector('.hex');
      const cp = p.querySelector('.copy-btn');

      const update = () => {
        let h = inp.value.trim().toUpperCase();
        if (!h.startsWith('#')) h = '#' + h;
        if (/^#[0-9A-F]{6}$/i.test(h)) {
          sw.dataset.hex = h; sw.style.background = h; render();
        }
      };
      inp.addEventListener('input', () => { inp.value = '#' + inp.value.replace(/[^0-9A-F]/gi, '').toUpperCase().slice(0, 6); update(); });
      sw.addEventListener('click', () => {
        const picker = document.createElement('input'); picker.type = 'color'; picker.value = sw.dataset.hex;
        picker.onchange = () => { const hex = picker.value.toUpperCase(); sw.dataset.hex = hex; sw.style.background = hex; inp.value = hex; render(); };
        picker.click();
      });
      cp.addEventListener('click', () => { navigator.clipboard.writeText(inp.value); cp.textContent = 'Copied'; setTimeout(() => cp.textContent = 'Copy', 1000); });
    });

    // === Controls ===
    const tie = (range, num) => {
      range.oninput = () => { num.value = range.value; render(); };
      num.oninput = () => { let v = parseFloat(num.value); if (!isNaN(v)) { const min = +range.min, max = +range.max; range.value = v >= min && v <= max ? v : (v < min ? min : max); render(); }};
    };
    tie($('#strokeRange'), $('#strokeNumber'));
    tie($('#textRange'), $('#textNumber'));

    $('#toggleStroke').onclick = () => { strokeOn = !strokeOn; $('#toggleStroke').textContent = strokeOn ? 'ON' : 'OFF'; render(); };

    $('#applySync').onclick = () => {
      const v = $('#syncSelect').value;
      if (v === 'stroke->fill') { const h = $('.color-picker[data-type="stroke"] .swatch').dataset.hex; const p = $('.color-picker[data-type="fill"]'); p.querySelector('.swatch').dataset.hex = h; p.querySelector('.swatch').style.background = h; p.querySelector('.hex').value = h; }
      if (v === 'fill->stroke') { const h = $('.color-picker[data-type="fill"] .swatch').dataset.hex; const p = $('.color-picker[data-type="stroke"]'); p.querySelector('.swatch').dataset.hex = h; p.querySelector('.swatch').style.background = h; p.querySelector('.hex').value = h; }
      render();
    };

    // === Font Upload (Click + Drag & Drop) ===
    async function uploadFonts(fileArray) {
      const added = [];
      for (const file of fileArray) {
        if (!/\.(ttf|otf|woff|woff2)$/i.test(file.name)) continue;
        const dataURL = await toDataURL(file);
        const name = file.name.split('.').slice(0, -1).join('.') || 'Font';
        const family = `${name.replace(/[^\w]/g, '_')}_${Date.now()}`;
        const id = `font_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;

        const font = { id, family, label: file.name, dataURL, fileName: file.name };
        await addFont(font);
        added.push(font);
      }
      await renderFonts();
      // Auto-select the **first** uploaded font (optional)
      if (added.length > 0) {
        currentFont = added[0];
        render();
      }
    }

    $('#uploadBtn').onclick = () => $('#fontFile').click();
    $('#panelUpload').onclick = () => $('#panelFile').click();
    $('#fontFile').onchange = e => e.target.files.length && uploadFonts(Array.from(e.target.files));
    $('#panelFile').onchange = e => e.target.files.length && uploadFonts(Array.from(e.target.files));

    // === Drag & Drop ===
    const dropZone = $('#dropZone');
    const fontsList = $('#fontsList');

    ['dragenter', 'dragover'].forEach(ev => fontsList.addEventListener(ev, e => { e.preventDefault(); dropZone.classList.add('active'); }));
    ['dragleave', 'drop'].forEach(ev => fontsList.addEventListener(ev, e => { e.preventDefault(); dropZone.classList.remove('active'); }));
    fontsList.addEventListener('drop', async e => {
      const files = Array.from(e.dataTransfer.files);
      if (files.length) await uploadFonts(files);
    });

    // === Font List ===
    async function renderFonts() {
      const fonts = await getAllFonts();
      $('#savedList').innerHTML = '';
      if (!fonts.length) {
        $('#savedList').innerHTML = '<div style="color:var(--muted);padding:6px">No saved fonts</div>';
        return;
      }
      fonts.forEach(font => {
        const div = document.createElement('div'); div.className = 'fontItem';
        const name = document.createElement('div'); name.className = 'fontPreview'; name.textContent = font.label;
        name.style.fontFamily = `'${font.family}'`;
        const acts = document.createElement('div'); acts.className = 'fontActions';
        const use = document.createElement('button'); use.className = 'small'; use.textContent = 'Use';
        use.onclick = e => { e.stopPropagation(); currentFont = font; render(); };
        const del = document.createElement('button'); del.className = 'small'; del.textContent = 'Del';
        del.onclick = async e => { e.stopPropagation(); await deleteFont(font.id); renderFonts(); if (currentFont?.id === font.id) { currentFont = null; render(); } };
        acts.append(use, del);
        div.append(name, acts);
        div.onclick = () => { currentFont = font; render(); };
        $('#savedList').appendChild(div);
      });
    }

    $('#clearAll').onclick = async () => {
      await clearAllFonts();
      currentFont = null;
      renderFonts();
      render();
    };

    // === Export PNG ===
    $('#exportBtn').onclick = () => {
      const svg = $('#svgLayer').querySelector('svg');
      if (!svg) return;
      const data = new XMLSerializer().serializeToString(svg);
      const blob = new Blob([data], {type: 'image/svg+xml'});
      const url = URL.createObjectURL(blob);
      const img = new Image();
      img.onload = () => {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const r = window.devicePixelRatio || 1;
        canvas.width = svg.viewBox.baseVal.width * r;
        canvas.height = svg.viewBox.baseVal.height * r;
        ctx.scale(r, r);
        ctx.drawImage(img, 0, 0);
        canvas.toBlob(b => {
          const a = document.createElement('a');
          a.href = URL.createObjectURL(b);
          a.download = 'roblox-logo.png';
          a.click();
          URL.revokeObjectURL(url);
        }, 'image/png');
      };
      img.src = url;
    };

    // === Init ===
    $('#textbox').addEventListener('input', render);
    $('#textbox').addEventListener('keydown', e => {
      if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); document.execCommand('insertLineBreak'); }
    });

    openDB().then(async () => {
      await renderFonts();
      render();
    });
  </script>
</body>
</html>
